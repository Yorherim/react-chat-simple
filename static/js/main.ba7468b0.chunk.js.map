{"version":3,"sources":["socket.js","reducer.js","components/JoinBlock.jsx","components/Chat.jsx","App.js","index.js"],"names":["socket","io","reducer","state","action","type","_objectSpread","joined","roomId","payload","userName","users","messages","concat","_toConsumableArray","JoinBlock","_ref","onLogin","_React$useState","React","useState","_React$useState2","_slicedToArray","setRoomId","_React$useState3","_React$useState4","setUserName","_React$useState5","_React$useState6","isLoading","setIsLoading","onEnter","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","obj","wrap","_context","prev","next","abrupt","alert","axios","post","stop","apply","arguments","_jsxs","className","children","_jsx","placeholder","value","onChange","e","target","disabled","onClick","Chat","onAddMessage","messageValue","setMessageValue","messagesRef","useRef","useEffect","current","scrollTo","length","map","name","index","ref","message","i","text","rows","emit","App","_React$useReducer","useReducer","_React$useReducer2","dispatch","setUsers","_yield$axios$get","data","get","sent","_x","addMessage","on","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.ba7468b0.chunk.js","sourcesContent":["import io from 'socket.io-client';\r\n\r\nconst socket = io();\r\n\r\nexport default socket;","const reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case 'JOINED':\r\n      return {\r\n        ...state,\r\n        joined: true,\r\n        roomId: action.payload.roomId,\r\n        userName: action.payload.userName,\r\n      }\r\n\r\n    case 'SET_DATA':\r\n      return {\r\n        ...state,\r\n        users: action.payload.users,\r\n        messages: action.payload.messages\r\n      }\r\n\r\n    case 'SET_USERS':\r\n      return {\r\n        ...state,\r\n        users: action.payload\r\n      }\r\n\r\n    case 'NEW_MESSAGE':\r\n      return {\r\n        ...state,\r\n        messages: [...state.messages, action.payload]\r\n      }\r\n\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport default reducer;","import React from 'react';\r\nimport socket from '../socket';\r\nimport axios from 'axios';\r\n\r\nfunction JoinBlock({ onLogin }) {\r\n  const [roomId, setRoomId] = React.useState('');\r\n  const [userName, setUserName] = React.useState('');\r\n  const [isLoading, setIsLoading] = React.useState(false);\r\n\r\n  const onEnter = async () => {\r\n    if (!roomId || !userName) {\r\n      return alert('Введите данные!');\r\n    }\r\n\r\n    const obj = { roomId, userName };\r\n    setIsLoading(true);\r\n    await axios.post('/rooms', obj);\r\n    onLogin(obj);\r\n  };\r\n\r\n  return (\r\n    <div className=\"join-block\">\r\n      <input\r\n        type=\"text\"\r\n        placeholder=\"Room ID\"\r\n        value={roomId}\r\n        onChange={(e) => setRoomId(e.target.value)}\r\n      />\r\n      <input\r\n        type=\"text\"\r\n        placeholder=\"Ваше имя\"\r\n        value={userName}\r\n        onChange={(e) => setUserName(e.target.value)}\r\n      />\r\n      <button disabled={isLoading} className=\"btn btn-success\" onClick={onEnter}>\r\n        {isLoading ? 'Вход...' : 'Войти'}\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default JoinBlock;\r\n","import React from 'react';\r\nimport socket from '../socket';\r\n\r\nfunction Chat({ users, messages, userName, roomId, onAddMessage }) {\r\n  const [messageValue, setMessageValue] = React.useState('');\r\n  const messagesRef = React.useRef(null);\r\n\r\n  const onSendMessage = () => {\r\n    socket.emit('ROOM: NEW_MESSAGE', {\r\n      roomId,\r\n      userName,\r\n      text: messageValue,\r\n    });\r\n    onAddMessage({ userName, text: messageValue });\r\n    setMessageValue('');\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    messagesRef.current.scrollTo(0, 99999);\r\n  }, [messages]);\r\n\r\n  return (\r\n    <div className=\"chat\">\r\n      <div className=\"chat-users\">\r\n        Комната: <b>{roomId}</b>\r\n        <hr></hr>\r\n        <b>Онлайн ({users.length}):</b>\r\n        <ul>\r\n          {users.map((name, index) => (\r\n            <li key={name + index}>{name}</li>\r\n          ))}\r\n        </ul>\r\n      </div>\r\n      <div className=\"chat-messages\">\r\n        <div ref={messagesRef} className=\"messages\">\r\n          {messages.map((message, i) => (\r\n            <div key={message + i} className=\"message\">\r\n              <p>{message.text}</p>\r\n              <div>\r\n                <span>{message.userName}</span>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <form>\r\n          <textarea\r\n            value={messageValue}\r\n            onChange={(e) => setMessageValue(e.target.value)}\r\n            className=\"form-control\"\r\n            rows=\"3\"></textarea>\r\n          <button onClick={onSendMessage} type=\"button\" className=\"btn btn-primary\">\r\n            Отправить\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Chat;\r\n","import React from 'react';\r\nimport axios from 'axios';\r\nimport socket from './socket';\r\n\r\nimport reducer from './reducer';\r\nimport JoinBlock from './components/JoinBlock';\r\nimport Chat from './components/Chat';\r\n\r\nfunction App() {\r\n  const [state, dispatch] = React.useReducer(reducer, {\r\n    joined: false,\r\n    roomId: null,\r\n    userName: null,\r\n    users: [],\r\n    messages: []\r\n  });\r\n\r\n  const setUsers = (users) => {\r\n    dispatch({\r\n      type: 'SET_USERS',\r\n      payload: users\r\n    });\r\n  }\r\n\r\n  const onLogin = async (obj) => {\r\n    dispatch({\r\n      type: 'JOINED',\r\n      payload: obj\r\n    });\r\n\r\n    // отправляем socket-запрос на backend\r\n    socket.emit(\"ROOM: JOIN\", obj);\r\n\r\n    const { data } = await axios.get(`/rooms/${obj.roomId}`);\r\n    dispatch({\r\n      type: 'SET_DATA',\r\n      payload: data\r\n    });\r\n  }\r\n\r\n  const addMessage = (message) => {\r\n    dispatch({\r\n      type: 'NEW_MESSAGE',\r\n      payload: message\r\n    })\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    socket.on('ROOM: SET_USERS', setUsers);\r\n    socket.on('ROOM: NEW_MESSAGE', addMessage);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"wrapper\">\r\n      {!state.joined ? <JoinBlock onLogin={onLogin} /> : <Chat {...state} onAddMessage={addMessage} />}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n\r\n"],"sourceRoot":""}